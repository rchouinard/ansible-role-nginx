{{ ansible_managed | comment }}

user {{ nginx_user }}{% if nginx_group %} {{ nginx_group }}{% endif %};

worker_processes {{ nginx_worker_processes }};
worker_rlimit_nofile {{ nginx_worker_rlimit_nofile }};

error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

include /usr/share/nginx/modules/*.conf;

events {
  worker_connections {{ nginx_worker_connections }};
}

http {
  server_tokens {{ nginx_http_server_tokens }};
  autoindex     {{ nginx_http_autoindex }};

  include mime.types;
  default_type application/octet-stream;

  # Default charset configuration
  charset {{ nginx_http_charset }};
  charset_types
    text/css
    text/plain
    text/vnd.wap.wml
    text/javascript
    text/markdown
    text/calendar
    text/x-component
    text/vcard
    text/cache-manifest
    text/vtt
    application/json
    application/manifest+json;

  # NCSA combined
  log_format  combined
    '$remote_addr - $remote_user [$time_local] "$request" '
    '$status $body_bytes_sent "$http_referer" '
    '"$http_user_agent" "$http_x_forwarded_for"';

  # NCSA combined w/vhost
  log_format  vcombined
    '$server_name:$server_port $remote_addr - '
    '$remote_user [$time_local] "$request" '
    '$status $body_bytes_sent "$http_referer" '
    '"$http_user_agent" "$http_x_forwarded_for"';

  access_log  /var/log/nginx/access.log  combined;

  sendfile          {{ nginx_http_sendfile }};
  tcp_nopush        {{ nginx_http_tcp_nopush }};
  tcp_nodelay       {{ nginx_http_tcp_nodelay }};
  keepalive_timeout {{ nginx_http_keepalive_timeout }};

  # Default gzip configuration
  gzip {{ nginx_http_gzip }};
  gzip_comp_level    {{ nginx_http_gzip_comp_level }};
  gzip_min_length    {{ nginx_http_gzip_min_length }};
  gzip_proxied       {{ nginx_http_gzip_proxied }};
  gzip_vary          {{ nginx_http_gzip_vary }};
  gzip_types
    application/atom+xml
    application/javascript
    application/json
    application/ld+json
    application/manifest+json
    application/rss+xml
    application/geo+json
    application/vnd.ms-fontobject
    application/x-web-app-manifest+json
    application/xhtml+xml
    application/xml
    application/rdf+xml
    font/otf
    application/wasm
    image/bmp
    image/svg+xml
    text/cache-manifest
    text/css
    text/javascript
    text/plain
    text/markdown
    text/vcard
    text/calendar
    text/vnd.rim.location.xloc
    text/vtt
    text/x-component
    text/x-cross-domain-policy;

  gzip_static {{ nginx_http_gzip_static }};

  # Default SSL/TLS configuration
  ssl_session_timeout        {{ nginx_http_ssl_session_timeout }};
  ssl_session_cache          {{ nginx_http_ssl_session_cache }};
  ssl_session_tickets        {{ nginx_http_ssl_session_tickets }};
  ssl_protocols              {{ nginx_http_ssl_protocols }};
  ssl_ciphers                {{ nginx_http_ssl_ciphers }};
  ssl_prefer_server_ciphers  {{ nginx_http_ssl_prefer_server_ciphers }};
  ssl_stapling               {{ nginx_http_ssl_stapling }};
  ssl_stapling_verify        {{ nginx_http_ssl_stapling_verify }};
  resolver                   {{ nginx_http_resolver }};
  resolver_timeout           {{ nginx_http_resolver_timeout }};

  include conf.d/*.conf;
  include sites.d/*;
}
